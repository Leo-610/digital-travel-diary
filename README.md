# 🗺️ 数字旅行记忆馆

一个功能丰富的旅行日记应用，支持本地存储和云端共享功能。

## ✨ 功能特点

### 核心功能
- 📝 创建和编辑旅行日记
- 📷 支持图片上传和压缩
- 🗺️ 交互式地图显示足迹
- 📍 地点搜索和定位
- 🏷️ 标签分类管理
- ⭐ 收藏功能
- 📊 数据统计

### 用户系统
- 🔐 用户注册和登录
- 👤 个人资料管理
- 📷 头像上传
- ☁️ 云端数据同步

### 共享功能
- 👥 查看所有用户的日记
- 📱 按用户分组显示
- 🔄 实时数据同步
- 🌐 多设备访问

## 🚀 快速开始

### 前提条件
- Node.js (推荐 v16 或更高版本)
- 现代浏览器（Chrome、Firefox、Edge等）

### 1. 项目设置

```bash
# 安装依赖
npm install

# 启动开发服务器
npm run dev

# 或者直接在浏览器中打开 index.html
```

### 2. Supabase 配置

1. **创建 Supabase 项目**
   - 访问 [https://supabase.com](https://supabase.com)
   - 创建新项目
   - 记录项目的 URL 和 anon key

2. **配置数据库**
   - 在 Supabase 项目的 SQL 编辑器中执行 `database-setup.sql` 文件中的所有 SQL 语句
   - 这将创建必要的表结构和安全策略

3. **设置环境变量**
   - 复制 `.env.example` 为 `.env`
   - 填入你的 Supabase 配置信息：
     ```
     SUPABASE_URL=你的项目URL
     SUPABASE_ANON_KEY=你的匿名密钥
     ```

4. **更新前端配置**
   - 打开 `supabase-client.js` 文件
   - 将第8-9行的配置信息替换为你的实际配置：
     ```javascript
     this.supabaseUrl = '你的项目URL';
     this.supabaseKey = '你的匿名密钥';
     ```

### 3. 启动应用

#### 方法一：使用开发服务器
```bash
# 启动后端服务器
npm start

# 在另一个终端启动前端服务器
npm run client
```

#### 方法二：直接打开HTML文件
```bash
# 如果不需要后端功能，可以直接用浏览器打开
open index.html
# 或在Windows上
start index.html
```

## 📖 使用指南

### 本地模式
- 不需要登录，数据存储在浏览器本地
- 支持所有基本功能：创建日记、添加图片、地图标记等
- 数据仅在当前浏览器中可用

### 云端模式
- 需要注册并登录账号
- 数据同步到云端，可在多设备访问
- 支持查看其他用户的共享日记
- 可以将本地数据同步到云端

### 使用步骤

1. **选择模式**
   - 点击界面上的"本地模式"或"云端模式"按钮

2. **云端模式登录**
   - 点击"注册"创建新账号
   - 或点击"登录"使用现有账号

3. **创建日记**
   - 点击右下角的"+"按钮
   - 填写标题、日期、地点、标签和内容
   - 可以添加图片（支持自动压缩）
   - 点击保存

4. **查看和管理**
   - 在"日记画廊"中查看所有日记
   - 在"我的收藏"中查看收藏的日记
   - 在"足迹地图"中查看地理位置
   - 在"共享日记"中查看其他用户的日记（需登录）

## 🔧 项目结构

```
数字旅行记忆馆/
├── index.html              # 主页面文件
├── supabase-client.js      # Supabase 客户端
├── server.js               # Node.js 服务器
├── package.json            # 项目配置
├── database-setup.sql      # 数据库初始化脚本
├── .env.example           # 环境变量示例
└── README.md              # 项目说明
```

## 🗄️ 数据库结构

### 用户档案表 (profiles)
- `id`: 用户唯一标识
- `nickname`: 用户昵称
- `avatar_url`: 头像链接
- `bio`: 个人简介

### 日记条目表 (diary_entries)
- `id`: 日记唯一标识
- `user_id`: 用户ID
- `title`: 标题
- `content`: 内容
- `location`: 地点
- `latitude/longitude`: 坐标
- `images`: 图片数据
- `tags`: 标签
- `is_public`: 是否公开

## 🔒 安全和隐私

- 使用 Supabase 的行级安全策略 (RLS)
- 用户只能修改自己的数据
- 支持邮箱验证注册
- 图片存储在安全的云端桶中

## 🛠️ 自定义配置

### 存储限制
- 本地存储：默认10MB限制
- 云端存储：依赖Supabase配额
- 图片压缩：自动将大图片压缩到合适大小

### 地图配置
- 支持多种地图图层
- 可以自定义地图样式
- 支持地点搜索和自动定位

## 🐛 故障排除

### 常见问题

1. **无法登录或注册**
   - 检查网络连接
   - 确认 Supabase 配置正确
   - 查看浏览器控制台错误信息

2. **图片上传失败**
   - 检查图片大小（建议小于5MB）
   - 确认图片格式支持（jpg, png, gif等）
   - 检查云端存储配置

3. **地图不显示**
   - 检查网络连接
   - 确认浏览器支持地理位置API
   - 查看控制台错误信息

4. **数据同步失败**
   - 检查登录状态
   - 确认网络连接稳定
   - 尝试手动刷新页面

### 开发调试

在浏览器开发者工具中查看控制台日志，应用会输出详细的运行信息。

## 📝 更新日志

### v1.0.0
- ✅ 基础日记功能
- ✅ 图片上传和压缩
- ✅ 地图集成
- ✅ 用户系统
- ✅ 云端同步
- ✅ 共享功能

## 🤝 贡献

欢迎提交 Issue 和 Pull Request！

## 📄 许可证

MIT License

## 📞 支持

如果遇到问题，请：
1. 查看本文档的故障排除部分
2. 检查浏览器控制台错误信息
3. 提交 Issue 描述问题详情

---

**享受记录旅行回忆的美好时光！** 🌟
