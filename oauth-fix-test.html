<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OAuth ä¿®å¤éªŒè¯</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .status {
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .warning { background: #fff3cd; color: #856404; border: 1px solid #ffeeba; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        .code {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 14px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ OAuth ç™»å½•ä¿®å¤éªŒè¯</h1>
    
    <div class="info">
        <h3>ğŸ“‹ å½“å‰çŠ¶æ€æ£€æŸ¥</h3>
        <p id="current-url"><strong>å½“å‰URL:</strong> <span id="url-display"></span></p>
        <p id="url-params"><strong>URLå‚æ•°:</strong> <span id="params-display"></span></p>
        <p id="error-check"><strong>é”™è¯¯æ£€æµ‹:</strong> <span id="error-display"></span></p>
    </div>

    <div class="warning">
        <h3>âš ï¸ ä¸»è¦é—®é¢˜ï¼šGitHub OAuthé…ç½®é”™è¯¯</h3>
        <p>æ ¹æ®é”™è¯¯æ—¥å¿—åˆ†æï¼Œä¸»è¦é—®é¢˜æ˜¯GitHub OAuthåº”ç”¨çš„å›è°ƒURLé…ç½®é”™è¯¯ã€‚</p>
        
        <h4>éœ€è¦ä¿®å¤çš„é…ç½®ï¼š</h4>
        <div class="code">
            <strong>GitHub OAuthåº”ç”¨è®¾ç½®ä½ç½®ï¼š</strong><br>
            https://github.com/settings/applications/2803708
            <br><br>
            <strong>å½“å‰é”™è¯¯çš„ Authorization callback URL:</strong><br>
            âŒ https://leo-610.github.io/digital-travel-diary
            <br><br>
            <strong>åº”è¯¥ä¿®æ”¹ä¸ºæ­£ç¡®çš„å›è°ƒURL:</strong><br>
            âœ… https://muawpgjdzoxhkpxghuvt.supabase.co/auth/v1/callback
        </div>
    </div>

    <div class="info">
        <h3>ğŸ”„ OAuthæµç¨‹è¯´æ˜</h3>
        <ol>
            <li><strong>ç”¨æˆ·ç‚¹å‡»GitHubç™»å½•</strong> â†’ é‡å®šå‘åˆ°GitHubæˆæƒé¡µé¢</li>
            <li><strong>ç”¨æˆ·æˆæƒ</strong> â†’ GitHubå›è°ƒåˆ°Supabaseç«¯ç‚¹å¤„ç†æˆæƒç </li>
            <li><strong>Supabaseå¤„ç†</strong> â†’ åˆ›å»ºç”¨æˆ·ä¼šè¯å¹¶é‡å®šå‘å›ç½‘ç«™</li>
            <li><strong>ç™»å½•å®Œæˆ</strong> â†’ ç”¨æˆ·åœ¨ç½‘ç«™ä¸Šçœ‹åˆ°ç™»å½•çŠ¶æ€</li>
        </ol>
        <p><strong>å…³é”®ç‚¹ï¼š</strong>GitHubçš„å›è°ƒURLå¿…é¡»æŒ‡å‘Supabaseçš„è®¤è¯ç«¯ç‚¹ï¼Œä¸æ˜¯ç”¨æˆ·ç½‘ç«™ï¼</p>
    </div>

    <div class="success">
        <h3>âœ… å·²å®æ–½çš„ä¿®å¤</h3>
        <ul>
            <li>æ·»åŠ äº†OAuthé”™è¯¯æ£€æµ‹å’Œç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º</li>
            <li>æ”¹è¿›äº†GitHubç™»å½•æ–¹æ³•çš„è°ƒè¯•ä¿¡æ¯</li>
            <li>è‡ªåŠ¨æ¸…ç†URLä¸­çš„é”™è¯¯å‚æ•°</li>
            <li>åˆ›å»ºäº†è¯¦ç»†çš„ä¿®å¤æŒ‡å—</li>
        </ul>
    </div>

    <div class="warning">
        <h3>ğŸ› ï¸ ç«‹å³è¡ŒåŠ¨æ­¥éª¤</h3>
        <ol>
            <li><button onclick="window.open('https://github.com/settings/applications/2803708', '_blank')">æ‰“å¼€GitHub OAuthåº”ç”¨è®¾ç½®</button></li>
            <li>æ‰¾åˆ° "Authorization callback URL" å­—æ®µ</li>
            <li>å°†URLä» <code>https://leo-610.github.io/digital-travel-diary</code> ä¿®æ”¹ä¸º <code>https://muawpgjdzoxhkpxghuvt.supabase.co/auth/v1/callback</code></li>
            <li>ç‚¹å‡» "Update application" ä¿å­˜</li>
            <li><button onclick="window.open('https://leo-610.github.io/digital-travel-diary', '_blank')">æµ‹è¯•GitHubç™»å½•</button></li>
        </ol>
    </div>

    <script>
        // æ˜¾ç¤ºå½“å‰URLä¿¡æ¯
        document.getElementById('url-display').textContent = window.location.href;
        
        // æ£€æŸ¥URLå‚æ•°
        const urlParams = new URLSearchParams(window.location.search);
        const params = [];
        for (let [key, value] of urlParams) {
            params.push(`${key}=${value}`);
        }
        document.getElementById('params-display').textContent = params.length > 0 ? params.join(', ') : 'æ— ';
        
        // æ£€æŸ¥æ˜¯å¦æœ‰OAuthé”™è¯¯
        const error = urlParams.get('error');
        const errorDescription = urlParams.get('error_description');
        
        if (error) {
            document.getElementById('error-display').innerHTML = `
                <span style="color: #dc3545;">âŒ æ£€æµ‹åˆ°é”™è¯¯</span><br>
                <strong>é”™è¯¯ç±»å‹ï¼š</strong> ${error}<br>
                <strong>é”™è¯¯æè¿°ï¼š</strong> ${errorDescription || 'æœªçŸ¥é”™è¯¯'}
            `;
            
            if (error === 'server_error' && errorDescription?.includes('Unable to exchange external code')) {
                document.getElementById('error-display').innerHTML += `
                    <br><br><strong style="color: #dc3545;">ğŸ¯ è¿™æ­£æ˜¯GitHub OAuthå›è°ƒURLé…ç½®é”™è¯¯å¯¼è‡´çš„ï¼</strong>
                `;
            }
        } else {
            document.getElementById('error-display').innerHTML = '<span style="color: #28a745;">âœ… æ— é”™è¯¯æ£€æµ‹</span>';
        }
        
        // å¦‚æœæœ‰é”™è¯¯å‚æ•°ï¼Œæ˜¾ç¤ºæ¸…ç†æŒ‰é’®
        if (error) {
            const cleanBtn = document.createElement('button');
            cleanBtn.textContent = 'æ¸…ç†URLå‚æ•°';
            cleanBtn.onclick = function() {
                const cleanUrl = window.location.origin + window.location.pathname;
                window.history.replaceState({}, document.title, cleanUrl);
                location.reload();
            };
            document.getElementById('error-check').appendChild(cleanBtn);
        }
    </script>
</body>
</html>
